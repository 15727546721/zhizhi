<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.xu.infrastructure.persistent.dao.ArticleCollectMapper">

    <resultMap id="BaseResultMap" type="cn.xu.infrastructure.persistent.po.ArticleCollect">
            <id property="id" column="id" />
            <result property="userId" column="user_id" />
            <result property="articleId" column="article_id" />
            <result property="status" column="status" />
            <result property="createTime" column="create_time" />
            <result property="updateTime" column="update_time" />
    </resultMap>

    <sql id="Base_Column_List">
        id,user_id,article_id,status,create_time,update_time
    </sql>
    
    <select id="findByUserIdAndArticleId" resultType="cn.xu.infrastructure.persistent.po.ArticleCollect">
        SELECT *
        FROM article_collect
        WHERE user_id = #{userId}
          AND article_id = #{articleId}
            LIMIT 1
    </select>
    
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO article_collect (user_id, article_id, status, create_time, update_time)
        VALUES (#{userId}, #{articleId}, #{status}, #{createTime}, #{updateTime})
    </insert>
    
    <update id="updateById">
        UPDATE article_collect
        SET user_id = #{userId},
            article_id = #{articleId},
            status = #{status},
            create_time = #{createTime},
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>
    
    <delete id="deleteByUserIdAndArticleId">
        DELETE FROM article_collect
        WHERE user_id = #{userId}
          AND article_id = #{articleId}
    </delete>
    
    <select id="findArticleIdsByUserId" resultType="java.lang.Long">
        SELECT article_id
        FROM article_collect
        WHERE user_id = #{userId}
          AND status = 1
    </select>
    
    <select id="countByUserId" resultType="int">
        SELECT COUNT(*)
        FROM article_collect
        WHERE user_id = #{userId}
          AND status = 1
    </select>
    
    <insert id="batchInsert">
        INSERT INTO article_collect (user_id, article_id, status, create_time, update_time)
        VALUES
        <foreach collection="articleCollects" item="item" separator=",">
            (#{item.userId}, #{item.articleId}, #{item.status}, #{item.createTime}, #{item.updateTime})
        </foreach>
    </insert>
    
    <delete id="batchDeleteByUserIdAndArticleIds">
        DELETE FROM article_collect
        WHERE user_id = #{userId}
          AND article_id IN
        <foreach collection="articleIds" item="articleId" open="(" separator="," close=")">
            #{articleId}
        </foreach>
    </delete>
</mapper>