# æœç´¢åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœç´¢åŠŸèƒ½æ˜¯ç‹¬ç«‹çš„ä¸šåŠ¡é¢†åŸŸï¼Œé‡‡ç”¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æ¶æ„ï¼Œæ”¯æŒå…³é”®è¯æœç´¢ã€ç­›é€‰ã€æ’åºç­‰åŠŸèƒ½ã€‚æ”¯æŒElasticsearchå’ŒMySQLä¸¤ç§æœç´¢ç­–ç•¥ï¼Œå¯æ ¹æ®æ•°æ®é‡å’Œç¯å¢ƒçµæ´»åˆ‡æ¢ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. é¢†åŸŸåˆ’åˆ†

æœç´¢ä¸šåŠ¡å·²ç‹¬ç«‹åˆ’åˆ†ä¸º**Searché¢†åŸŸ**ï¼Œä¸å…¶ä»–é¢†åŸŸï¼ˆPostã€Userç­‰ï¼‰è§£è€¦ï¼š

```
ğŸ“¦ æœç´¢é¢†åŸŸ (Search Domain)
â”œâ”€â”€ ğŸ“ é¢†åŸŸå±‚ (domain.search)
â”‚   â”œâ”€â”€ model/entity/          # æœç´¢æŸ¥è¯¢å®ä½“
â”‚   â”œâ”€â”€ model/valobj/          # æœç´¢ç­›é€‰æ¡ä»¶ã€æœç´¢ç»“æœå€¼å¯¹è±¡
â”‚   â”œâ”€â”€ model/policy/          # æœç´¢ç­–ç•¥æ¥å£
â”‚   â””â”€â”€ service/               # æœç´¢é¢†åŸŸæœåŠ¡ã€æœç´¢ç»Ÿè®¡æœåŠ¡
â”‚
â”œâ”€â”€ ğŸ“ åº”ç”¨å±‚ (application.service)
â”‚   â””â”€â”€ SearchApplicationService  # åè°ƒæœç´¢é¢†åŸŸå’Œå…¶ä»–é¢†åŸŸ
â”‚
â”œâ”€â”€ ğŸ“ åŸºç¡€è®¾æ–½å±‚ (infrastructure.search)
â”‚   â”œâ”€â”€ strategy/              # æœç´¢ç­–ç•¥å®ç°ï¼ˆESã€MySQLã€ç¼“å­˜ï¼‰
â”‚   â”œâ”€â”€ service/               # æœç´¢ç»Ÿè®¡æœåŠ¡å®ç°
â”‚   â””â”€â”€ util/                  # å…³é”®è¯è§„èŒƒåŒ–å·¥å…·
â”‚
â””â”€â”€ ğŸ“ æ¥å£å±‚ (api.web.controller)
    â””â”€â”€ PostSearchController   # æœç´¢APIæ¥å£
```

### 2. åˆ†å±‚æ¶æ„

```
æ¥å£å±‚ (Controller)
    â†“ ä¾èµ–
åº”ç”¨å±‚ (Application Service)
    â†“ ä¾èµ–
é¢†åŸŸå±‚ (Domain Service)
    â†‘ å®ç°
åŸºç¡€è®¾æ–½å±‚ (Infrastructure)
```

### 3. ç­–ç•¥æ¨¡å¼

æ”¯æŒå¤šç§æœç´¢ç­–ç•¥ï¼Œå¯é€šè¿‡é…ç½®åˆ‡æ¢ï¼š

- **Elasticsearchç­–ç•¥**ï¼šé«˜æ€§èƒ½å…¨æ–‡æœç´¢ï¼Œæ”¯æŒåˆ†è¯ã€ç›¸å…³æ€§æ’åº
- **MySQLç­–ç•¥**ï¼šç®€å•æœç´¢ï¼Œä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œå§‹ç»ˆå¯ç”¨
- **ç¼“å­˜ç­–ç•¥**ï¼šè£…é¥°å™¨æ¨¡å¼ï¼Œæå‡æœç´¢æ€§èƒ½

### 4. é¢†åŸŸæ¨¡å‹

#### æ ¸å¿ƒæ¨¡å‹
- **SearchQuery**ï¼šå°è£…æœç´¢æŸ¥è¯¢ä¿¡æ¯ï¼ˆå…³é”®è¯ã€ç­›é€‰æ¡ä»¶ã€åˆ†é¡µå‚æ•°ï¼‰
- **SearchFilter**ï¼šæœç´¢ç­›é€‰æ¡ä»¶å€¼å¯¹è±¡ï¼ˆç±»å‹ã€æ—¶é—´èŒƒå›´ã€æ’åºæ–¹å¼ï¼‰
- **SearchResult**ï¼šæœç´¢ç»“æœå€¼å¯¹è±¡
- **ISearchStrategy**ï¼šæœç´¢ç­–ç•¥æ¥å£ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰

#### é¢†åŸŸæœåŠ¡
- **ISearchDomainService**ï¼šæœç´¢é¢†åŸŸæœåŠ¡ï¼Œè´Ÿè´£æ‰§è¡Œæœç´¢å’Œè®°å½•æœç´¢è¡Œä¸º
- **ISearchStatisticsService**ï¼šæœç´¢ç»Ÿè®¡æœåŠ¡ï¼Œè´Ÿè´£è®°å½•æœç´¢ç»Ÿè®¡ã€çƒ­é—¨æœç´¢è¯ç­‰

## ğŸ”§ é…ç½®è¯´æ˜

### 1. æœç´¢ç­–ç•¥é…ç½®

```yaml
app:
  post:
    query:
      strategy: mysql  # æœç´¢ç­–ç•¥ï¼šelasticsearch æˆ– mysql
      cache:
        enabled: true  # æ˜¯å¦å¯ç”¨æœç´¢ç¼“å­˜ï¼Œé»˜è®¤true
```

### 2. Elasticsearché…ç½®ï¼ˆå¯é€‰ï¼‰

```yaml
spring:
  elasticsearch:
    uris: 127.0.0.1:9200  # Elasticsearchåœ°å€
```

### 3. ç­–ç•¥é€‰æ‹©é€»è¾‘

1. **é¦–é€‰ç­–ç•¥**ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ `app.post.query.strategy` æŒ‡å®šçš„ç­–ç•¥
2. **è‡ªåŠ¨é™çº§**ï¼šå¦‚æœé¦–é€‰ç­–ç•¥ä¸å¯ç”¨ï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è‡ªåŠ¨é€‰æ‹©ï¼š
   - Elasticsearchï¼ˆå¦‚æœå¯ç”¨ä¸”å¯ç”¨ï¼‰
   - MySQLï¼ˆå§‹ç»ˆå¯ç”¨ï¼Œä½œä¸ºæœ€ç»ˆå…œåº•ï¼‰
3. **è¿è¡Œæ—¶é™çº§**ï¼šå¦‚æœæœç´¢è¿‡ç¨‹ä¸­Elasticsearchå¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°MySQL

## ğŸ“¡ APIæ¥å£

### 1. æœç´¢å¸–å­

**æ¥å£**ï¼š`GET /api/post/search`

**å‚æ•°**ï¼š
- `keyword`ï¼ˆå¿…éœ€ï¼‰ï¼šæœç´¢å…³é”®è¯
- `types`ï¼ˆå¯é€‰ï¼‰ï¼šå¸–å­ç±»å‹ç­›é€‰ï¼ˆå¤šä¸ªç±»å‹ï¼Œç”¨é€—å·åˆ†éš”ï¼‰
- `timeRange`ï¼ˆå¯é€‰ï¼‰ï¼šå‘å¸ƒæ—¶é—´èŒƒå›´ï¼ˆall/day/week/month/yearï¼‰
- `sortOption`ï¼ˆå¯é€‰ï¼‰ï¼šæ’åºæ–¹å¼ï¼ˆtime/hot/comment/likeï¼‰
- `page`ï¼ˆå¯é€‰ï¼‰ï¼šé¡µç ï¼Œé»˜è®¤ä¸º1
- `size`ï¼ˆå¯é€‰ï¼‰ï¼šé¡µé¢å¤§å°ï¼Œé»˜è®¤ä¸º10

**ç¤ºä¾‹**ï¼š
```bash
GET /api/post/search?keyword=Java&types=ARTICLE,POST&timeRange=week&sortOption=hot&page=1&size=10
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "title": "JavaåŸºç¡€æ•™ç¨‹",
        "description": "JavaåŸºç¡€...",
        "content": "æ‘˜è¦...",
        "type": "ARTICLE",
        "authorName": "å¼ ä¸‰",
        "viewCount": 100,
        "likeCount": 10,
        "commentCount": 5,
        "createTime": "2024-01-01T10:00:00"
      }
    ],
    "total": 100,
    "page": 1,
    "size": 10
  }
}
```

### 2. è·å–æœç´¢å»ºè®®

**æ¥å£**ï¼š`GET /api/post/search/suggestions`

**å‚æ•°**ï¼š
- `keyword`ï¼ˆå¯é€‰ï¼‰ï¼šæœç´¢å…³é”®è¯å‰ç¼€
- `limit`ï¼ˆå¯é€‰ï¼‰ï¼šè¿”å›æ•°é‡ï¼Œé»˜è®¤10

**ç¤ºä¾‹**ï¼š
```bash
GET /api/post/search/suggestions?keyword=Java&limit=10
```

### 3. è·å–çƒ­é—¨æœç´¢è¯

**æ¥å£**ï¼š`GET /api/post/search/hot-keywords`

**å‚æ•°**ï¼š
- `limit`ï¼ˆå¯é€‰ï¼‰ï¼šè¿”å›æ•°é‡ï¼Œé»˜è®¤10

**ç¤ºä¾‹**ï¼š
```bash
GET /api/post/search/hot-keywords?limit=10
```

### 4. è·å–æœç´¢ç»Ÿè®¡

**æ¥å£**ï¼š`GET /api/post/search/statistics`

**å‚æ•°**ï¼š
- `date`ï¼ˆå¯é€‰ï¼‰ï¼šæ—¥æœŸï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰ï¼Œå¦‚æœä¸ºç©ºåˆ™è¿”å›ä»Šå¤©çš„ç»Ÿè®¡

**ç¤ºä¾‹**ï¼š
```bash
GET /api/post/search/statistics?date=2024-01-01
```

## ğŸ’» ä½¿ç”¨æ–¹å¼

### 1. åç«¯ä½¿ç”¨

#### åœ¨Serviceä¸­ä½¿ç”¨

```java
@Resource
private SearchApplicationService searchApplicationService;

public void searchPosts(String keyword) {
    SearchFilter filter = SearchFilter.builder()
        .types(Arrays.asList(PostType.ARTICLE, PostType.POST))
        .sortOption(SearchFilter.SortOption.HOT)
        .build();
    
    SearchApplicationService.SearchResult result = 
        searchApplicationService.executeSearch(keyword, filter, 1, 10);
    
    List<PostSearchResponse> posts = result.getPosts();
    long total = result.getTotal();
}
```

#### ç›´æ¥ä½¿ç”¨é¢†åŸŸæœåŠ¡

```java
@Resource
private ISearchDomainService searchDomainService;

public void searchPosts(String keyword) {
    SearchFilter filter = SearchFilter.builder()
        .types(Arrays.asList(PostType.ARTICLE))
        .build();
    
    Pageable pageable = PageRequest.of(0, 10);
    Page<PostEntity> posts = searchDomainService.executeSearch(keyword, filter, pageable);
}
```

### 2. å‰ç«¯ä½¿ç”¨

#### æœç´¢æ¥å£è°ƒç”¨

```javascript
import { searchPosts } from '@/api/post'

// æœç´¢å¸–å­
const search = async (keyword) => {
  const response = await searchPosts({
    keyword: keyword,
    types: ['ARTICLE', 'POST'],
    timeRange: 'week',
    sortOption: 'hot',
    page: 1,
    size: 10
  })
  return response.data
}
```

#### æœç´¢å»ºè®®

```javascript
import { getSearchSuggestions } from '@/api/post'

// è·å–æœç´¢å»ºè®®
const getSuggestions = async (keyword) => {
  const response = await getSearchSuggestions(keyword, 10)
  return response.data
}
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ ¸å¿ƒåŠŸèƒ½

- âœ… **å…³é”®è¯æœç´¢**ï¼šæ”¯æŒæ ‡é¢˜å’Œæè¿°æœç´¢
- âœ… **ç­›é€‰åŠŸèƒ½**ï¼šæ”¯æŒç±»å‹ã€æ—¶é—´èŒƒå›´ç­›é€‰
- âœ… **æ’åºåŠŸèƒ½**ï¼šæ”¯æŒæœ€æ–°ã€æœ€çƒ­ã€è¯„è®ºã€ç‚¹èµæ’åº
- âœ… **åˆ†é¡µåŠŸèƒ½**ï¼šæ”¯æŒåˆ†é¡µæŸ¥è¯¢
- âœ… **æœç´¢å»ºè®®**ï¼šåŸºäºçƒ­é—¨æœç´¢è¯æä¾›å»ºè®®
- âœ… **çƒ­é—¨æœç´¢è¯**ï¼šç»Ÿè®¡å¹¶å±•ç¤ºçƒ­é—¨æœç´¢è¯
- âœ… **æœç´¢ç»Ÿè®¡**ï¼šè®°å½•æœç´¢è¡Œä¸ºï¼Œæä¾›ç»Ÿè®¡åˆ†æ

### 2. é«˜çº§åŠŸèƒ½

- âœ… **å…³é”®è¯è§„èŒƒåŒ–**ï¼šå…¨è§’è½¬åŠè§’ã€Unicodeè§„èŒƒåŒ–
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼šRedisç¼“å­˜æœç´¢ç»“æœï¼Œæå‡æ€§èƒ½
- âœ… **ç­–ç•¥åˆ‡æ¢**ï¼šæ”¯æŒESå’ŒMySQLç­–ç•¥åˆ‡æ¢
- âœ… **è‡ªåŠ¨é™çº§**ï¼šESä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ°MySQL
- âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šESç´¢å¼•å’Œç¼“å­˜è‡ªåŠ¨åŒæ­¥

## ğŸ” æœç´¢ç­–ç•¥å¯¹æ¯”

### Elasticsearchç­–ç•¥

**ä¼˜ç‚¹**ï¼š
- æ”¯æŒä¸­æ–‡åˆ†è¯ï¼ˆIKåˆ†è¯å™¨ï¼‰
- æ”¯æŒç›¸å…³æ€§æ’åº
- æ€§èƒ½ä¼˜ç§€ï¼Œé€‚åˆå¤§æ•°æ®é‡æœç´¢
- æ”¯æŒå¤æ‚çš„æœç´¢æŸ¥è¯¢

**ç¼ºç‚¹**ï¼š
- éœ€è¦é¢å¤–çš„ElasticsearchæœåŠ¡
- éœ€è¦ç»´æŠ¤ç´¢å¼•åŒæ­¥
- é…ç½®ç›¸å¯¹å¤æ‚

**é€‚ç”¨åœºæ™¯**ï¼š
- ç”Ÿäº§ç¯å¢ƒ
- å¤§æ•°æ®é‡æœç´¢
- éœ€è¦é«˜è´¨é‡æœç´¢ä½“éªŒ

### MySQLç­–ç•¥

**ä¼˜ç‚¹**ï¼š
- æ— éœ€é¢å¤–æœåŠ¡
- å®ç°ç®€å•ï¼Œç¨³å®šå¯é 
- æ•°æ®å®æ—¶æ€§é«˜ï¼ˆæ— éœ€åŒæ­¥ï¼‰

**ç¼ºç‚¹**ï¼š
- ä½¿ç”¨LIKEæŸ¥è¯¢ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½
- ä¸æ”¯æŒåˆ†è¯å’Œç›¸å…³æ€§æ’åº
- ä¸é€‚åˆå¤§æ•°æ®é‡æœç´¢

**é€‚ç”¨åœºæ™¯**ï¼š
- å¼€å‘/æµ‹è¯•ç¯å¢ƒ
- å°æ•°æ®é‡æœç´¢ï¼ˆ< 10ä¸‡æ¡ï¼‰
- ä¸éœ€è¦ESåŠŸèƒ½çš„åœºæ™¯

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´
- **ç¼“å­˜å‘½ä¸­**ï¼š< 10ms
- **MySQLæœç´¢**ï¼š50-300msï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
- **ESæœç´¢**ï¼š50-200msï¼ˆå–å†³äºæ•°æ®é‡ï¼‰

### ç¼“å­˜å‘½ä¸­ç‡ï¼ˆé¢„è®¡ï¼‰
- **çƒ­é—¨æœç´¢**ï¼š> 80%
- **æ™®é€šæœç´¢**ï¼š> 60%

### ç¼“å­˜ç­–ç•¥
- **çƒ­é—¨å…³é”®è¯**ï¼šç¼“å­˜1å°æ—¶ï¼ˆÂ±10%éšæœºTTLï¼‰
- **æ™®é€šå…³é”®è¯**ï¼šç¼“å­˜5åˆ†é’Ÿï¼ˆÂ±10%éšæœºTTLï¼‰
- **ç©ºç»“æœ**ï¼šç¼“å­˜1åˆ†é’Ÿï¼ˆÂ±10%éšæœºTTLï¼‰

## ğŸ”’ å®‰å…¨æ€§

### å‚æ•°æ ¡éªŒ
- **å…³é”®è¯é•¿åº¦**ï¼šæœ€å¤§100å­—ç¬¦
- **åˆ†é¡µå‚æ•°**ï¼špage >= 1, size 1-100
- **SQLæ³¨å…¥é˜²æŠ¤**ï¼šMySQL LIKEæŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰
- **XSSé˜²æŠ¤**ï¼šå‰ç«¯HTMLè½¬ä¹‰ï¼ˆå…³é”®è¯é«˜äº®ï¼‰

### é˜²åˆ·æœºåˆ¶
- **æœç´¢ç»Ÿè®¡é˜²åˆ·**ï¼šåŒä¸€å…³é”®è¯60ç§’å†…åªè®°å½•ä¸€æ¬¡ç»Ÿè®¡
- **åŸå­æ“ä½œ**ï¼šä½¿ç”¨SETNXé¿å…ç«æ€æ¡ä»¶

## ğŸ”„ æ•°æ®ä¸€è‡´æ€§

### ESç´¢å¼•åŒæ­¥
- **è‡ªåŠ¨åˆå§‹åŒ–**ï¼šåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶åˆå§‹åŒ–ESç´¢å¼•ï¼ˆå¦‚æœæ•°æ®ä¸ä¸€è‡´ï¼‰
- **å®æ—¶åŒæ­¥**ï¼šå¸–å­åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ—¶è‡ªåŠ¨åŒæ­¥
- **åŒæ­¥æ–¹å¼**ï¼šäº‹ä»¶é©±åŠ¨ï¼Œå¼‚æ­¥å¤„ç†
- **å®¹é”™å¤„ç†**ï¼šESåŒæ­¥å¤±è´¥ä¸å½±å“ä¸»æµç¨‹

### ç¼“å­˜å¤±æ•ˆ
- **å¤±æ•ˆæ—¶æœº**ï¼šå¸–å­åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ—¶
- **å¤±æ•ˆç­–ç•¥**ï¼šç²¾ç¡®æå–å…³é”®è¯ï¼Œæ¸…é™¤ç›¸å…³ç¼“å­˜
- **å¤±æ•ˆæ–¹å¼**ï¼šä½¿ç”¨SCANå‘½ä»¤ï¼Œé¿å…é˜»å¡Redis

## ğŸ“ æ•°æ®åº“ç´¢å¼•

### æ¨èç´¢å¼•

æ‰§è¡Œä»¥ä¸‹SQLè„šæœ¬åˆ›å»ºç´¢å¼•ï¼š

```sql
-- æ ‡é¢˜å‰ç¼€ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_post_title_prefix ON post(title(50));

-- æè¿°å‰ç¼€ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_post_description_prefix ON post(description(100));

-- çŠ¶æ€+æ—¶é—´å¤åˆç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_post_status_time ON post(status, create_time DESC);

-- å…¨æ–‡ç´¢å¼•ï¼ˆMySQL 5.7+ï¼‰
ALTER TABLE post ADD FULLTEXT INDEX IF NOT EXISTS ft_title_desc(title, description);
```

**SQLè„šæœ¬ä½ç½®**ï¼š`zhizhi-backend/src/main/resources/sql/post_search_indexes.sql`

## ğŸš€ æ‰©å±•æ–°æœç´¢ç­–ç•¥

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„æœç´¢ç­–ç•¥ï¼ˆå¦‚Solrã€Meilisearchç­‰ï¼‰ï¼š

1. å®ç° `ISearchStrategy` æ¥å£
2. ä½¿ç”¨ `@Component` æ³¨è§£æ³¨å†Œä¸ºSpring Bean
3. åœ¨ç­–ç•¥å·¥å‚ä¸­ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ³¨å†Œ

**ç¤ºä¾‹**ï¼š
```java
@Component
public class SolrSearchStrategy implements ISearchStrategy {
    @Override
    public Page<PostEntity> search(String keyword, SearchFilter filter, Pageable pageable) {
        // å®ç°Solræœç´¢é€»è¾‘
    }
    
    @Override
    public boolean isAvailable() {
        // æ£€æŸ¥Solræ˜¯å¦å¯ç”¨
        return true;
    }
    
    @Override
    public String getStrategyName() {
        return "solr";
    }
}
```

## ğŸ”§ ESç´¢å¼•ç®¡ç†

### è‡ªåŠ¨åˆå§‹åŒ–

åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥ESç´¢å¼•çŠ¶æ€ï¼Œå¦‚æœæ£€æµ‹åˆ°æ•°æ®ä¸ä¸€è‡´ï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼š

**åˆå§‹åŒ–æ¡ä»¶**ï¼š
- ESç´¢å¼•ä¸ºç©ºï¼ˆ`esCount == 0`ï¼‰
- ESç´¢å¼•åŒæ­¥ç‡ä½äºé˜ˆå€¼ï¼ˆé»˜è®¤50%ï¼‰

**é…ç½®é¡¹**ï¼š
```yaml
app:
  elasticsearch:
    auto-init:
      enabled: true  # æ˜¯å¦å¯ç”¨è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆé»˜è®¤trueï¼‰
      sync-threshold: 0.5  # åŒæ­¥é˜ˆå€¼ï¼Œå¦‚æœESæ•°æ®é‡å°äºMySQLçš„æ­¤ç™¾åˆ†æ¯”ï¼Œåˆ™è‡ªåŠ¨åŒæ­¥ï¼ˆé»˜è®¤0.5ï¼Œå³50%ï¼‰
```

**æ—¥å¿—è¾“å‡º**ï¼š
- å¯åŠ¨æ—¶ä¼šè¾“å‡ºï¼š`ESç´¢å¼•çŠ¶æ€æ£€æŸ¥: MySQLå·²å‘å¸ƒå¸–å­=X, ESç´¢å¼•å¸–å­=Y, åŒæ­¥ç‡=Z%`
- å¦‚æœéœ€è¦åˆå§‹åŒ–ï¼Œä¼šè¾“å‡ºï¼š`æ£€æµ‹åˆ°ESç´¢å¼•æ•°æ®ä¸ä¸€è‡´ï¼Œå¼€å§‹è‡ªåŠ¨åˆå§‹åŒ–...`
- åˆå§‹åŒ–å®Œæˆåè¾“å‡ºï¼š`ESå¸–å­ç´¢å¼•åˆå§‹åŒ–å®Œæˆï¼å…±ç´¢å¼• X ä¸ªå¸–å­`

### æ‰‹åŠ¨ç®¡ç†æ¥å£

#### 1. æ£€æŸ¥ç´¢å¼•çŠ¶æ€

æ£€æŸ¥Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®é‡å’ŒåŒæ­¥çŠ¶æ€ï¼š

```bash
curl -X GET "http://localhost:8091/api/admin/elasticsearch/status"
```

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "info": "ç´¢å¼•çŠ¶æ€æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "esPostCount": 100,
    "mysqlPostCount": 150,
    "syncRate": 66.67,
    "message": "ç´¢å¼•çŠ¶æ€æŸ¥è¯¢æˆåŠŸ"
  }
}
```

#### 2. é‡æ–°ç´¢å¼•æ‰€æœ‰å¸–å­

å°†MySQLä¸­æ‰€æœ‰å·²å‘å¸ƒçš„å¸–å­é‡æ–°ç´¢å¼•åˆ°Elasticsearchï¼š

```bash
curl -X POST "http://localhost:8091/api/admin/elasticsearch/reindex"
```

#### 3. é‡æ–°ç´¢å¼•å•ä¸ªå¸–å­

é‡æ–°ç´¢å¼•æŒ‡å®šIDçš„å¸–å­ï¼š

```bash
curl -X POST "http://localhost:8091/api/admin/elasticsearch/reindex/123"
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- è‡ªåŠ¨åˆå§‹åŒ–å¤±è´¥æ—¶ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘å…¨é‡é‡æ–°ç´¢å¼•
- æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œæ£€æŸ¥ç´¢å¼•çŠ¶æ€å¹¶æ‰§è¡Œé‡æ–°ç´¢å¼•
- å•ä¸ªå¸–å­æœç´¢ä¸åˆ°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªå¸–å­é‡æ–°ç´¢å¼•

## ğŸ” æ•…éšœæ’æŸ¥

### ESæœç´¢è¿”å›ç©ºç»“æœ

**ç°è±¡**ï¼šä½¿ç”¨ESç­–ç•¥æœç´¢æ—¶è¿”å›ç©ºç»“æœï¼Œä½†MySQLç­–ç•¥å¯ä»¥è¿”å›æ•°æ®

**åŸå› **ï¼šMySQLæ•°æ®æœªåŒæ­¥åˆ°ESï¼Œå†å²æ•°æ®ä¸åœ¨ESç´¢å¼•ä¸­

**å¤„ç†**ï¼š
1. æ£€æŸ¥ç´¢å¼•çŠ¶æ€ï¼š`GET /api/admin/elasticsearch/status`
2. å¦‚æœ `syncRate < 100%`ï¼Œæ‰§è¡Œé‡æ–°ç´¢å¼•ï¼š`POST /api/admin/elasticsearch/reindex`
3. é‡æ–°ç´¢å¼•å®Œæˆåï¼Œå†æ¬¡æ£€æŸ¥ç´¢å¼•çŠ¶æ€

### Elasticsearchä¸å¯ç”¨

**ç°è±¡**ï¼šæœç´¢å¤±è´¥æˆ–æ€§èƒ½ä¸‹é™

**å¤„ç†**ï¼š
1. ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°MySQLç­–ç•¥
2. æ£€æŸ¥ElasticsearchæœåŠ¡çŠ¶æ€
3. æŸ¥çœ‹æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯

### æœç´¢æ€§èƒ½é—®é¢˜

**å¤„ç†**ï¼š
1. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
2. æ£€æŸ¥æ•°æ®åº“ç´¢å¼•
3. ä¼˜åŒ–æœç´¢å…³é”®è¯ï¼ˆé¿å…è¿‡é•¿çš„å…³é”®è¯ï¼‰
4. è€ƒè™‘åˆ‡æ¢åˆ°Elasticsearchç­–ç•¥
5. ç¡®ä¿ESç´¢å¼•å·²åŒæ­¥ï¼ˆæ£€æŸ¥ç´¢å¼•çŠ¶æ€ï¼‰

### ç¼“å­˜ä¸ä¸€è‡´

**å¤„ç†**ï¼š
1. æ‰‹åŠ¨æ¸…é™¤æœç´¢ç¼“å­˜
2. æ£€æŸ¥ESç´¢å¼•åŒæ­¥çŠ¶æ€
3. æŸ¥çœ‹äº‹ä»¶ç›‘å¬å™¨æ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- æœç´¢åŠŸèƒ½å®ç°æ€»ç»“ï¼š`docs/æœç´¢åŠŸèƒ½å®ç°æ€»ç»“.md`
- DDDè§„èŒƒæ–‡æ¡£ï¼š`docs/architecture/ddd/DDDè§„èŒƒæ–‡æ¡£.md`

## âœ¨ æ€»ç»“

æœç´¢åŠŸèƒ½é‡‡ç”¨DDDæ¶æ„ï¼Œç‹¬ç«‹åˆ’åˆ†ä¸ºSearché¢†åŸŸï¼Œä»£ç ç»„ç»‡æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚æ”¯æŒElasticsearchå’ŒMySQLä¸¤ç§æœç´¢ç­–ç•¥ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µçµæ´»åˆ‡æ¢ã€‚å…·å¤‡å®Œå–„çš„ç¼“å­˜æœºåˆ¶ã€æ•°æ®ä¸€è‡´æ€§ä¿è¯å’Œå®‰å…¨æ€§é˜²æŠ¤ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚

