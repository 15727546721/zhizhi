# 排行榜功能方案

## 一、功能概述

适用于中小社区（5-10万用户）的排行榜系统，支持多维度排序。

### 1.1 帖子排行榜维度
- **热度榜** - 综合点赞、评论、收藏计算
- **点赞榜** - 按点赞数排序
- **收藏榜** - 按收藏数排序
- **评论榜** - 按评论数排序
- **浏览榜** - 按浏览量排序
- **最新榜** - 按发布时间排序

### 1.2 用户排行榜维度
- **综合榜** - 综合粉丝、获赞、帖子数计算
- **粉丝榜** - 按粉丝数排序
- **获赞榜** - 按获赞数排序
- **活跃榜** - 按发帖数排序

### 1.3 标签排行榜维度
- **使用量榜** - 按标签使用次数排序

## 二、后端 API

### 2.1 用户排行榜

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/ranking/users` | GET | 用户排行榜（支持多种排序） |
| `/api/ranking/users/fans` | GET | 粉丝排行榜 |
| `/api/ranking/users/likes` | GET | 获赞排行榜 |
| `/api/ranking/users/active` | GET | 活跃用户排行榜 |

**参数：**
- `type`: 排序类型（fans/likes/posts/comprehensive）
- `limit`: 返回数量（默认20，最大100）

**响应数据结构：**
```json
{
  "code": 20000,
  "data": [{
    "rank": 1,
    "userId": 123,
    "username": "zhangsan",
    "nickname": "张三",
    "avatar": "https://...",
    "bio": "个人简介",
    "fansCount": 1000,
    "likeCount": 500,
    "postCount": 50,
    "score": 850
  }]
}
```

### 2.2 帖子排行榜

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/ranking/posts` | GET | 帖子排行榜（支持多维度+时间范围） |
| `/api/ranking/posts/week` | GET | 帖子周榜 |
| `/api/ranking/posts/month` | GET | 帖子月榜 |

**参数：**
- `period`: 时间范围（week/month/all）
- `sort`: 排序维度（hot/likes/favorites/comments/views/latest）
- `limit`: 返回数量（默认20，最大100）

**排序维度说明：**
| sort值 | 说明 |
|--------|------|
| hot | 热度（点赞+评论×2+收藏×3） |
| likes | 点赞数 |
| favorites | 收藏数 |
| comments | 评论数 |
| views | 浏览量 |
| latest | 发布时间 |

**响应数据结构：**
```json
{
  "code": 20000,
  "data": [{
    "rank": 1,
    "postId": 456,
    "title": "帖子标题",
    "coverUrl": "https://...",
    "userId": 123,
    "nickname": "张三",
    "avatar": "https://...",
    "viewCount": 1000,
    "likeCount": 100,
    "commentCount": 50,
    "favoriteCount": 30,
    "createTime": "2025-11-27T10:00:00",
    "score": 380
  }]
}
```

### 2.3 标签排行榜

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/ranking/tags` | GET | 标签排行榜 |

**参数：**
- `sort`: 排序方式（count/hot）
- `period`: 时间范围（week/month/all）
- `limit`: 返回数量（默认20，最大100）

**响应数据结构：**
```json
{
  "code": 20000,
  "data": [{
    "rank": 1,
    "tagId": 123,
    "name": "Vue",
    "description": "前端框架",
    "usageCount": 500
  }]
}
```

### 2.4 关注动态

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/home/following` | GET | 获取关注用户的帖子动态 |

**参数：**
- `page`: 页码（默认1）
- `size`: 每页数量（默认10）

## 三、前端页面

### 3.1 文件结构

```
src/
├── api/
│   └── ranking.js          # 排行榜 API
├── views/
│   ├── home/
│   │   └── RankingPage.vue  # 热门榜单入口页
│   └── ranking/
│       ├── UserRanking.vue    # 用户排行榜独立页
│       └── ArticleRanking.vue # 帖子排行榜独立页
```

### 3.2 路由配置

| 路由 | 页面 | 说明 |
|------|------|------|
| `/ranking` | RankingPage.vue | 热门榜单入口（综合页面） |

### 3.3 页面功能

**热门榜单页（RankingPage.vue）**
- Tab 切换：热门帖子榜、收藏帖子榜、作者榜
- 时间筛选：7天、30天
- 右侧边栏：榜单说明、热门标签

**用户排行榜页（UserRanking.vue）**
- Tab 切换：综合榜、粉丝榜、获赞榜、活跃榜
- 显示：排名、头像、昵称、简介、帖子数、粉丝数、获赞数

**帖子排行榜页（ArticleRanking.vue）**
- Tab 切换：周榜、月榜、总榜
- 显示：排名、标题、作者、发布时间、浏览数、点赞数、评论数

## 四、热度计算公式

### 帖子热度
```
score = likeCount + commentCount × 2 + favoriteCount × 3
```

### 用户综合分数
```
score = fansCount × 0.4 + likeCount × 0.4 + postCount × 0.2
```

## 五、数据缓存

### 5.1 用户排行榜缓存

使用 Redis ZSet 存储，由定时任务每小时更新：
- Key: `user:ranking:{sortType}` (fans/likes/posts/comprehensive)
- Score: 对应的统计数值
- Member: 用户ID

### 5.2 帖子排行榜

实时查询数据库，按热度公式排序：
- 周榜：`create_time >= NOW() - 7 days`
- 月榜：`create_time >= NOW() - 30 days`
- 总榜：无时间限制

## 六、维护要点

### 6.1 定时任务

| 任务 | 频率 | 说明 |
|------|------|------|
| UserRankingCacheUpdateTask | 每小时 | 更新用户排行榜缓存 |

### 6.2 性能优化

1. **用户排行榜**：使用 Redis 缓存，避免实时计算
2. **帖子排行榜**：数据库索引优化（status, create_time, like_count 等）
3. **分页限制**：最大返回 100 条

### 6.3 扩展建议

- 如果数据量增长，帖子排行榜也可改为缓存方式
- 可以增加更多时间维度（今日榜、年榜）
- 可以增加分类榜单（按标签筛选）

## 七、已实现功能清单

- [x] 用户排行榜 API（综合/粉丝/获赞/活跃）
- [x] 帖子排行榜 API（周榜/月榜/总榜）
- [x] 关注动态 Feed API
- [x] 前端排行榜 API 封装
- [x] 前端热门榜单入口页
- [x] 前端用户排行榜页面
- [x] 前端帖子排行榜页面
- [x] 用户排行榜缓存定时任务（已有）
