# 邮件服务配置指南

## 配置位置

配置文件：`src/main/resources/application.yml`

```yaml
spring:
  mail:
    host: smtp.qq.com                          # SMTP服务器地址
    port: 587                                   # SMTP端口
    username: your_email@qq.com                 # 发件人邮箱
    password: your_authorization_code           # 邮箱授权码（不是密码）
```

## 常用邮箱SMTP配置

### QQ邮箱
```yaml
host: smtp.qq.com
port: 587        # TLS
# 或 port: 465   # SSL
```
**获取授权码**：QQ邮箱 → 设置 → 账户 → POP3/SMTP服务 → 开启 → 生成授权码

### 163邮箱
```yaml
host: smtp.163.com
port: 25         # 无加密
# 或 port: 465   # SSL
```
**获取授权码**：163邮箱 → 设置 → POP3/SMTP/IMAP → 开启 → 设置授权码

### Gmail
```yaml
host: smtp.gmail.com
port: 587        # TLS
```
**注意**：需要开启"允许不够安全的应用"或使用应用专用密码

### 阿里企业邮箱
```yaml
host: smtp.qiye.aliyun.com
port: 465        # SSL
```

### 腾讯企业邮箱
```yaml
host: smtp.exmail.qq.com
port: 465        # SSL
```

## 功能说明

### 已实现的邮件功能

| 功能 | 方法 | 说明 |
|------|------|------|
| 验证码邮件 | `sendVerifyCode(email, code)` | 用户注册验证码 |
| 密码重置邮件 | `sendPasswordResetEmail(email, token, resetUrl)` | 密码重置链接 |
| 欢迎邮件 | `sendWelcomeEmail(email, nickname)` | 注册成功欢迎 |
| 通用HTML邮件 | `sendHtmlEmail(to, subject, content)` | 自定义HTML |
| 通用文本邮件 | `sendTextEmail(to, subject, content)` | 纯文本邮件 |

### 调用示例

```java
@Resource
private EmailService emailService;

// 发送验证码
emailService.sendVerifyCode("user@example.com", "123456");

// 发送密码重置邮件
emailService.sendPasswordResetEmail("user@example.com", "token123", "https://example.com/reset");

// 发送欢迎邮件
emailService.sendWelcomeEmail("user@example.com", "张三");
```

## 注意事项

1. **授权码 ≠ 密码**：大多数邮箱需要使用授权码而非登录密码
2. **端口选择**：
   - 587: TLS加密（推荐）
   - 465: SSL加密
   - 25: 无加密（不推荐）
3. **异步发送**：所有邮件方法都使用`@Async`异步发送，不会阻塞主线程
4. **发送频率**：注意邮箱服务商的发送频率限制

## 测试配置

配置完成后，可以通过日志观察邮件发送情况：
```
[邮件服务] 发送成功 - to: xxx@example.com, subject: 【知知社区】邮箱验证码
```

如果发送失败，会抛出`BusinessException`并记录错误日志。
