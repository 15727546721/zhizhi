# 命名规范

## 1. 包命名规范

### 1.1 包名结构
- 所有包名使用小写字母
- 采用反向域名作为根包名：`cn.xu`
- 按照功能模块组织包结构

### 1.2 分层包命名
```
cn.xu
├── cache           # 缓存层
├── common          # 公共模块
├── config          # 配置类
├── controller      # 控制器层
├── event           # 事件处理
├── integration     # 外部集成
├── model           # 数据模型
├── repository      # 数据访问层
├── service         # 业务服务层
├── support         # 支撑模块
└── task            # 定时任务
```

### 1.3 业务包命名
```
service
├── post            # 帖子服务
├── comment         # 评论服务
├── user            # 用户服务
├── file            # 文件服务
└── ...             # 其他服务
```

## 2. 类命名规范

### 2.1 实体类命名
- 实体类名使用名词，首字母大写
- 不强制 `Entity` 后缀，直接使用业务名称
- 示例：`User`, `Post`, `Comment`, `Tag`

### 2.2 DTO命名规范
- **请求对象**：使用 `*Request` 后缀，表示前端传入的请求参数
  - 示例：`LoginFormRequest`, `CreatePostRequest`, `UserRegisterRequest`
- **内部数据对象**：不强制后缀，用于服务层内部数据传输
  - 示例：`PostAndTagAgg`, `PostTagRelation`, `TagStatistics`

### 2.3 VO命名规范
- 视图对象类名使用 `*VO` 后缀
- 用于封装返回给前端展示的数据
- 示例：`UserVO`, `PostDetailVO`, `CommentVO`, `LikeStatusVO`

### 2.4 仓储接口命名
- 仓储接口名使用领域名 + `Repository`（遵循 Spring Data 命名风格，不使用 `I` 前缀）
- 示例：`PostRepository`, `UserRepository`, `CommentRepository`

### 2.5 仓储实现类命名
- 仓储实现类名使用领域名 + `RepositoryImpl`
- 示例：`PostRepositoryImpl`, `UserRepositoryImpl`

### 2.6 Mapper接口命名
- MyBatis Mapper 接口使用领域名 + `Mapper`
- 示例：`PostMapper`, `UserMapper`, `CommentMapper`

### 2.7 服务接口命名
- 服务接口名使用领域名 + `Service`（不使用 `I` 前缀，遵循 Spring/Java 主流规范）
- 示例：`UserService`, `PostService`, `CommentService`

### 2.8 服务实现类命名
- 服务实现类名使用领域名 + `ServiceImpl`
- 示例：`UserServiceImpl`, `PostServiceImpl`
- 注：简单服务可直接使用 `*Service` 作为实现类名

### 2.9 控制器类命名
- 控制器类名使用业务名 + `Controller`
- 示例：`PostController`, `UserController`, `CommentController`

### 2.10 配置类命名
- 配置类名使用配置内容 + `Config`
- 示例：`RedisConfig`, `WebConfig`, `AsyncConfig`

### 2.11 异常类命名
- 异常类名使用业务含义 + `Exception`
- 示例：`BusinessException`, `ValidationException`, `AuthenticationException`

### 2.12 定时任务类命名
- 定时任务类名使用任务内容 + `Task`
- 使用 `@Component` 注解
- 示例：`RedisSyncTask`, `HotScoreSyncTask`, `MessageCleanupTask`

## 3. 方法命名规范

### 3.1 CRUD操作方法命名

#### 3.1.1 创建操作
- `save(T entity)` - 保存实体（创建或更新）
- `create(T entity)` - 创建实体
- `insert(T entity)` - 插入实体

#### 3.1.2 查询操作
- `findById(Long id)` - 根据ID查询单个实体
- `findAll()` - 查询所有实体
- `findByXxx(parameters)` - 根据条件查询实体
- `existsById(Long id)` - 判断实体是否存在
- `count()` - 统计实体数量

#### 3.1.3 更新操作
- `save(T entity)` - 保存实体（创建或更新）
- `update(T entity)` - 更新实体
- `updateXxx(parameters)` - 更新特定属性

#### 3.1.4 删除操作
- `deleteById(Long id)` - 根据ID删除实体
- `deleteByXxx(parameters)` - 根据条件删除实体
- `deleteAll()` - 删除所有实体

### 3.2 Mapper方法命名规范

Mapper 接口方法使用统一的前缀区分操作类型：

| 前缀 | 用途 | 返回类型 | 示例 |
|------|------|----------|------|
| `selectXxx` | 单条查询 | `T` 或 `Optional<T>` | `selectById(Long id)` |
| `findXxx` | 列表查询 | `List<T>` | `findByUserId(Long userId)` |
| `countXxx` | 统计查询 | `Long` 或 `int` | `countByStatus(Integer status)` |
| `saveXxx` | 插入操作 | `Long`（返回ID）或 `int` | `saveComment(Comment comment)` |
| `updateXxx` | 更新操作 | `int`（影响行数） | `updateLikeCount(Long id, int count)` |
| `deleteXxx` | 删除操作 | `int`（影响行数） | `deleteById(Long id)` |
| `batchXxx` | 批量操作 | `int` 或 `List<T>` | `batchDelete(List<Long> ids)` |
| `existsXxx` | 存在性判断 | `boolean` | `existsById(Long id)` |

**注意事项：**
- 避免同一功能使用不同前缀（如 `findById` 和 `selectById` 同时存在）
- 分页查询方法建议使用 `findXxxByPage` 命名
- 带排序的查询方法建议使用 `findXxxByHot`、`findXxxByTime` 等后缀

### 3.3 业务方法命名
- 使用动词开头，描述业务操作
- 方法名应具有明确的业务含义
- 示例：
  - `publishPost()` - 发布帖子
  - `addComment()` - 添加评论
  - `likePost()` - 点赞帖子
  - `followUser()` - 关注用户

### 3.4 查询方法返回类型规范
- 查询单个实体：`Optional<T>` 或 `T`（确保不为空时）
- 查询多个实体：`List<T>`
- 判断存在性：`boolean`
- 统计数量：`long` 或 `int`

## 4. 变量命名规范

### 4.1 局部变量命名
- 使用驼峰命名法
- 变量名应具有明确的业务含义
- 示例：
  - `userName` - 用户名
  - `postList` - 帖子列表
  - `commentCount` - 评论数量

### 4.2 成员变量命名（依赖注入）
- Mapper 变量：使用 `xxxMapper` 命名
- Repository 变量：使用 `xxxRepository` 命名
- Service 变量：使用 `xxxService` 命名
- 示例：
  - `userMapper` - 用户Mapper
  - `postRepository` - 帖子仓储
  - `commentService` - 评论服务

### 4.3 常量命名
- 使用大写字母和下划线
- 常量名应具有明确的业务含义
- 示例：
  - `MAX_PAGE_SIZE` - 最大页面大小
  - `DEFAULT_TIMEOUT` - 默认超时时间

### 4.4 集合变量命名
- 集合变量名应体现其内容
- 使用复数形式或 `List`/`Map` 后缀
- 示例：
  - `users` 或 `userList` - 用户列表
  - `postIds` - 帖子ID集合
  - `commentMap` - 评论映射

## 5. 数据库字段命名规范

### 5.1 字段名规范
- 使用下划线分隔的小写字母
- 字段名应具有明确的业务含义
- 示例：
  - `user_name` - 用户名
  - `post_id` - 帖子ID
  - `create_time` - 创建时间

### 5.2 时间字段命名
- 创建时间：`create_time`
- 更新时间：`update_time`
- 删除时间：`delete_time`

### 5.3 状态字段命名
- 状态字段：`status`
- 类型字段：`type`

## 6. 配置参数命名规范

### 6.1 配置属性命名
- 使用驼峰命名法
- 配置名应具有明确的业务含义
- 示例：
  - `app.post.pageSize` - 帖子页面大小
  - `redis.host` - Redis主机地址

### 6.2 环境变量命名
- 使用大写字母和下划线
- 示例：
  - `DATABASE_URL` - 数据库URL
  - `REDIS_HOST` - Redis主机地址

## 7. URL路径命名规范

### 7.1 RESTful API路径
- 使用小写字母和连字符
- 路径应具有明确的业务含义
- 示例：
  - `/api/v1/posts` - 帖子API
  - `/api/v1/users/{userId}/posts` - 用户帖子API

### 7.2 查询参数命名
- 使用驼峰命名法
- 参数名应具有明确的业务含义
- 示例：
  - `pageNo` - 页码
  - `pageSize` - 页面大小
  - `sortBy` - 排序字段

## 8. 文件命名规范

### 8.1 Java文件命名
- 文件名与类名保持一致
- 使用大写字母开头的驼峰命名法
- 示例：
  - `PostService.java`
  - `UserRepository.java`

### 8.2 配置文件命名
- 使用小写字母和连字符
- 示例：
  - `application.yml`
  - `database-config.xml`

### 8.3 文档文件命名
- 使用中文或英文命名
- 使用小写字母和连字符
- 示例：
  - `ddd-规范文档.md`
  - `api-design-guide.md`


## 9. Redis Key 命名规范

### 9.1 Key 命名格式
- 格式：`模块:资源:操作:ID`
- 使用冒号 `:` 分隔各部分
- 使用小写字母和下划线
- 避免使用特殊字符
- 控制 Key 长度（建议 < 100 字符）

### 9.2 Key 命名示例
| 模块 | Key 格式 | 示例 |
|------|----------|------|
| 帖子 | `post:detail:{postId}` | `post:detail:123` |
| 帖子浏览 | `post:view:count:{postId}` | `post:view:count:123` |
| 帖子点赞 | `post:like:count:{postId}` | `post:like:count:123` |
| 帖子热榜 | `post:rank:hot` | `post:rank:hot` |
| 用户信息 | `user:info:{userId}` | `user:info:456` |
| 用户关注 | `follow:following:{userId}` | `follow:following:456` |
| 用户粉丝 | `follow:followers:{userId}` | `follow:followers:456` |
| 点赞关系 | `like:{type}:{targetId}` | `like:post:123` |
| 点赞计数 | `like:count:{type}:{targetId}` | `like:count:post:123` |
| 评论热榜 | `comment:rank:hot:{type}:{targetId}` | `comment:rank:hot:post:123` |
| 收藏计数 | `favorite:count:{type}:{targetId}` | `favorite:count:post:123` |
| 标签热榜 | `tag:hot:{timeRange}:{limit}` | `tag:hot:week:10` |

### 9.3 TTL 常量规范
所有 TTL 常量统一定义在 `RedisKeyManager` 类中：

| 常量名 | 值 | 用途 |
|--------|-----|------|
| `DEFAULT_TTL` | 3600 (1小时) | 默认缓存过期时间 |
| `COUNT_TTL` | 30天 | 计数类数据过期时间 |
| `RELATION_TTL` | 1800 (30分钟) | 用户关系过期时间 |
| `RANKING_TTL` | 300 (5分钟) | 排行榜过期时间 |
| `EMPTY_RESULT_TTL` | 60 (1分钟) | 空结果过期时间 |
| `SHORT_EMPTY_RESULT_TTL` | 30 (30秒) | 短期空结果过期时间 |
| `COMMENT_TTL` | 600 (10分钟) | 评论缓存过期时间 |
| `POST_HOT_RANK_TTL` | 1800 (30分钟) | 帖子热榜过期时间 |

### 9.4 Key 构建规范
- 所有 Redis Key 必须通过 `RedisKeyManager` 类的静态方法构建
- 禁止在业务代码中硬编码 Key 字符串
- 新增 Key 类型时，需在 `RedisKeyManager` 中添加对应方法

## 10. Elasticsearch 索引命名规范

### 10.1 索引命名格式
- 使用小写字母
- 使用复数形式表示集合
- 示例：`posts`, `comments`, `users`

### 10.2 字段类型规范
| 字段类型 | ES 类型 | 说明 |
|----------|---------|------|
| ID | `Long` + `@Id` | 主键 |
| 文本搜索 | `FieldType.Text` | 需要分词搜索的字段 |
| 精确匹配 | `FieldType.Keyword` | 不需要分词的字符串 |
| 数值 | `FieldType.Long/Integer/Double` | 数值类型 |
| 日期 | `FieldType.Date` | 日期时间类型 |
| 布尔 | `FieldType.Boolean` | 布尔类型 |
| 嵌套对象 | `FieldType.Nested` | 嵌套文档 |

### 10.3 分词器配置
- 默认使用 `standard` 分词器
- 如需中文分词，需安装 IK 插件并配置 `ik_max_word` 或 `ik_smart`
- 搜索分词器建议与索引分词器保持一致

### 10.4 索引设置规范
```java
@Document(indexName = "posts")
@Setting(shards = 1, replicas = 0)  // 开发环境配置
public class PostIndex {
    // ...
}
```

**生产环境建议：**
- `shards`: 根据数据量设置，一般 3-5 个
- `replicas`: 至少 1 个副本保证高可用
