# 项目结构说明

> 本项目采用简化的三层架构，遵循"实用主义"原则，移除了过度的DDD抽象。

## 1. 整体目录结构

```
zhizhi-backend/
├── docs/                          # 文档目录
│   ├── 功能模块/                  # 功能模块文档
│   ├── 开发规范/                  # 开发规范文档
│   ├── 部署/                      # 部署相关文档
│   └── 配置/                      # 配置说明
├── src/                           # 源代码目录
│   ├── main/
│   │   ├── java/cn.xu/           # 项目根包
│   │   │   ├── application/      # 应用服务层
│   │   │   ├── cache/            # 缓存服务
│   │   │   ├── common/           # 通用组件
│   │   │   ├── config/           # 配置类
│   │   │   ├── controller/       # 控制器层
│   │   │   ├── event/            # 事件处理
│   │   │   ├── integration/      # 外部集成
│   │   │   ├── model/            # 数据模型
│   │   │   ├── repository/       # 数据仓储
│   │   │   ├── service/          # 业务服务
│   │   │   ├── support/          # 支撑组件
│   │   │   └── task/             # 定时任务
│   │   └── resources/            # 资源文件
│   └── test/                     # 测试代码
└── target/                       # 编译输出目录
```

## 2. 控制器层 (controller)

```
controller/
├── admin/                        # 后台管理API
│   ├── SysPostController.java   # 帖子管理
│   ├── SysUserController.java   # 用户管理
│   ├── SysTagController.java    # 标签管理
│   ├── SysCommentController.java # 评论管理
│   └── ...                       # 其他管理接口
└── web/                          # 前台用户API
    ├── PostController.java      # 帖子接口
    ├── UserController.java      # 用户接口
    ├── CommentController.java   # 评论接口
    ├── TagController.java       # 标签接口
    ├── HomeController.java      # 首页接口
    ├── FavoriteController.java  # 收藏接口
    ├── FollowController.java    # 关注接口
    ├── LikeController.java      # 点赞接口
    └── ...                       # 其他接口
```

## 3. 业务服务层 (service)

```
service/
├── post/                         # 帖子服务
│   ├── PostService.java         # 帖子核心服务
│   ├── TagService.java          # 标签服务
│   ├── PostTagService.java      # 帖子标签关联
│   └── PostValidationService.java # 帖子校验
├── comment/                      # 评论服务
│   └── CommentService.java      # 评论核心服务
├── user/                         # 用户服务
│   ├── UserService.java         # 用户核心服务
│   └── IUserService.java        # 用户接口
├── favorite/                     # 收藏服务
│   └── FavoriteService.java     # 收藏核心服务
├── follow/                       # 关注服务
│   └── FollowService.java       # 关注核心服务
├── like/                         # 点赞服务
├── notification/                 # 通知服务
├── message/                      # 私信服务
├── search/                       # 搜索服务
└── permission/                   # 权限服务
```

## 4. 数据模型层 (model)

```
model/
├── entity/                       # 数据实体（核心PO）
│   ├── Post.java                # 帖子（包含业务方法）
│   ├── User.java                # 用户
│   ├── Comment.java             # 评论
│   ├── Tag.java                 # 标签
│   ├── Like.java                # 点赞
│   ├── Favorite.java            # 收藏
│   ├── Follow.java              # 关注
│   ├── Notification.java        # 通知
│   └── ...                       # 其他实体
├── dto/                          # 数据传输对象
│   ├── post/                    # 帖子DTO
│   ├── comment/                 # 评论DTO
│   └── ...                       # 其他DTO
├── vo/                           # 视图对象
│   ├── post/                    # 帖子VO
│   ├── comment/                 # 评论VO
│   ├── user/                    # 用户VO
│   └── ...                       # 其他VO
└── converter/                    # VO转换器
```

## 5. 数据仓储层 (repository)

```
repository/
├── ICommentRepository.java      # 评论仓储接口
├── IFavoriteRepository.java     # 收藏仓储接口
├── IFollowRepository.java       # 关注仓储接口
├── impl/                         # 仓储实现
│   ├── PostRepository.java      # 帖子仓储
│   ├── CommentRepositoryImpl.java # 评论仓储
│   └── ...                       # 其他实现
├── mapper/                       # MyBatis Mapper
│   ├── PostMapper.java          # 帖子Mapper
│   ├── CommentMapper.java       # 评论Mapper
│   └── ...                       # 其他Mapper
└── read/                         # 只读数据源
    └── elastic/                  # Elasticsearch
```

## 6. 缓存层 (cache)

```
cache/
├── BaseCacheRepository.java     # 缓存基类
├── RedisService.java            # Redis服务
├── RedisKeyManager.java         # Key管理
├── PostCacheRepository.java     # 帖子缓存
├── CommentCacheRepository.java  # 评论缓存
├── LikeCacheRepository.java     # 点赞缓存
├── FavoriteCacheRepository.java # 收藏缓存
├── FollowCacheRepository.java   # 关注缓存
└── TagCacheRepository.java      # 标签缓存
```

## 7. 设计原则

### 7.1 实用主义
- **直接使用PO承载业务逻辑**：不再使用Entity/Aggregate层
- **零对象转换**：Repository直接返回PO
- **单一Service**：每个模块一个核心Service

### 7.2 充血模型
```java
// 实体包含业务方法
public class Post {
    public void publish() { this.status = STATUS_PUBLISHED; }
    public void increaseLikeCount() { this.likeCount++; }
    public void validateOwnership(Long userId, boolean isAdmin) { ... }
}
```

### 7.3 分层依赖
```
Controller -> Service -> Repository -> Mapper
     ↓           ↓           ↓
   (调用)      (业务)      (数据)
```

## 8. 核心模块说明

| 模块 | 说明 |
|------|------|
| Post | 帖子发布、编辑、草稿、热度计算 |
| Tag | 标签管理、热门标签、标签分类 |
| User | 用户认证、个人资料、用户统计 |
| Comment | 评论、回复、楼层 |
| Like | 帖子/评论点赞 |
| Favorite | 收藏夹、帖子收藏 |
| Follow | 用户关注、粉丝 |
| Notification | 系统通知、互动通知 |
| Message | 私信系统 |
| Search | 聚合搜索（ES/MySQL双策略） |

## 9. 包命名规范

- 所有包名使用小写字母
- 控制器：`controller.web`（前台）、`controller.admin`（后台）
- 服务：`service.{模块名}`
- 实体：`model.entity`
- DTO：`model.dto.{模块名}`
- VO：`model.vo.{模块名}`