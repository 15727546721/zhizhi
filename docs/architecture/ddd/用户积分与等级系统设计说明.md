# 用户积分与等级系统设计说明

## 1. 概述

本文档详细描述了知之社区系统的用户积分与等级功能设计，旨在为后续系统维护和功能扩展提供清晰的技术文档支持。该系统采用简化设计，适用于个人维护的小型社区场景。

## 2. 核心设计理念

### 2.1 设计原则
- **简洁性**：针对小社区场景，避免复杂功能设计
- **可追溯性**：完整记录积分获取和消费历史
- **透明性**：用户可清楚了解积分来源和用途
- **可扩展性**：支持未来规则调整和功能扩展

### 2.2 系统目标
- 激励用户积极参与社区活动
- 通过等级制度增强用户归属感
- 提供积分消费和兑换机制
- 支持积分规则的灵活调整

## 3. 核心概念

### 3.1 积分（Points）
积分是社区内的虚拟货币，具有实际价值，用户可通过参与社区活动获得并用于消费。

### 3.2 等级（Level）
等级体现用户在社区中的成长历程和地位，代表用户的身份和可享受的权益。

### 3.3 积分记录（Point Record）
记录用户每次积分变动的详细信息，包括获得和消费。

## 4. 数据库设计

### 4.1 用户积分总表（user_total_points）
存储用户积分的核心数据：
- `id`：主键ID
- `user_id`：用户ID
- `total_earned_points`：历史总获得积分
- `current_points`：当前剩余积分
- `create_time`：创建时间
- `update_time`：更新时间

### 4.2 积分记录表（point_record）
详细记录每次积分变动：
- `id`：主键ID
- `user_id`：用户ID
- `action_type`：积分动作类型
- `points`：积分变化值（正数为获得，负数为使用）
- `balance`：操作后余额
- `description`：描述
- `create_time`：创建时间

## 5. 积分规则

### 5.1 获取积分规则

#### 平台活跃值
| 动作 | 积分值 | 单日积分上限 | 备注 |
|------|--------|--------------|------|
| 点赞 | 1 | 上限1次 | 点赞文章/交流/问题/评论/回复可获得 |
| 收藏 | 1 | 上限1次 | 收藏文章/交流/问题可获得 |
| 发布 | 5 | 上限2次 | 发布文章/交流/问题/评论/回复可获得 |
| 关注 | 3 | 上限1次 | 关注其他用户，本人可获得 |
| 信息完善 | 5 | 仅第一次可获取 | 绑定手机号、上传头像、修改个人昵称 |
| 成为会员 | 10 | 无上限 | 成为/续费会员可获得 |
| 邀请推广 | 10 | 无上限 | 邀请好友成为会员可获得 |
| 购买/兑换课程 | 5 | 无上限 | 购买/兑换单个课程加分 |

#### 平台影响力
| 动作 | 积分值 | 单日积分上限 | 备注 |
|------|--------|--------------|------|
| 被点赞 | 1 | 无上限 | 文章/交流/问题/评论/回复被点赞可获得 |
| 被收藏 | 1 | 无上限 | 文章/交流/问题被收藏可获得 |
| 帖子被精选 | 20 | 无上限 | 文章/交流/问题被精选 |
| 评论被精选 | 10 | 无上限 | 评论/回复被精选 |
| 被关注 | 3 | 无上限 | 被其他用户关注可获得 |
| 回答被采纳 | 10 | 无上限 | 「问题」板块的回答被采纳 |
| 被推荐 | 5 | 无上限 | 文章/交流/问题被推荐可获得 |

### 5.2 积分动作类型定义
- LIKE_GIVE（点赞）
- LIKE_RECEIVE（被点赞）
- FAVORITE_GIVE（收藏）
- FAVORITE_RECEIVE（被收藏）
- PUBLISH（发布）
- FOLLOW_GIVE（关注）
- FOLLOW_RECEIVE（被关注）
- INFO_COMPLETE（信息完善）
- VIP_JOIN（成为会员）
- INVITE（邀请推广）
- BUY_COURSE（购买课程）
- POST_FEATURED（帖子被精选）
- COMMENT_FEATURED（评论被精选）
- ANSWER_ACCEPTED（回答被采纳）
- POST_RECOMMENDED（被推荐）

## 6. 等级规则

| 等级 | 所需积分 |
|------|----------|
| 1 | 0 |
| 2 | 25 |
| 3 | 200 |
| 4 | 500 |
| 5 | 1000 |
| 6 | 2000 |
| 7 | 4000 |

## 7. 系统特性

### 7.1 积分管理
- 实时记录积分获取和消费
- 支持积分余额查询
- 提供积分变动历史查询

### 7.2 等级计算
- 基于历史总获得积分计算用户等级
- 自动升级机制
- 等级权益展示

### 7.3 数据统计
- 用户积分排行榜
- 积分获取途径统计
- 积分消费情况分析

## 8. 技术实现要点

### 8.1 数据一致性
- 使用事务确保积分变动和记录的一致性
- 积分余额与记录总和保持一致

### 8.2 性能优化
- 积分查询使用索引优化
- 批量操作支持

### 8.3 扩展性设计
- 积分规则可配置化
- 动作类型可扩展
- 等级规则可调整

## 9. 后续维护建议

### 9.1 规则调整
- 积分获取规则可根据运营需要调整
- 等级门槛可根据用户成长情况优化

### 9.2 功能扩展
- 积分商城功能
- 等级专属权益
- 积分赠送和转账功能

### 9.3 数据分析
- 定期分析积分获取和消费数据
- 优化积分规则以提高用户活跃度
- 监控异常积分变动情况