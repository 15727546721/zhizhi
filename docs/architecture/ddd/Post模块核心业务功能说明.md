# Post模块核心业务功能说明

## 1. 概述

Post模块是知之社区系统的核心功能模块之一，支持多种类型的帖子发布。该模块遵循领域驱动设计（DDD）原则，采用清晰的分层架构，实现了完整的帖子生命周期管理。

## 2. 核心业务功能

### 2.1 帖子类型支持

Post模块中的帖子支持多种类型，通过 `PostType` 枚举定义：

1. **ARTICLE（文章类型）**：用于发布长篇内容，适合技术文章、教程等
2. **POST（普通帖子类型）**：用于一般性内容发布，适合日常分享、动态等
3. **DISCUSSION（讨论类型）**：用于发起讨论话题，适合社区讨论
4. **QUESTION（问答类型）**：用于提问和回答，支持采纳最佳回答功能
5. **RESOURCE（资源分享类型）**：用于分享资源
6. **ANSWER（回答类型）**：专门用于问答帖的回答

### 2.2 帖子状态管理

帖子具有三种状态：
- **DRAFT（草稿）**：帖子创建后的默认状态，可以编辑但不对外显示
- **PUBLISHED（已发布）**：帖子发布后进入此状态，对外公开显示
- **DELETED（已删除）**：帖子删除后进入此状态，不再对外显示

### 2.3 核心业务操作

1. **创建帖子**：支持创建不同类型的帖子草稿
2. **编辑帖子**：允许在草稿状态下编辑帖子内容
3. **发布帖子**：将草稿发布为正式帖子
4. **撤回帖子**：将已发布的帖子撤回到草稿状态
5. **删除帖子**：删除帖子（逻辑删除）
6. **浏览帖子**：查看帖子详情，支持增加浏览量统计
7. **点赞/取消点赞**：对帖子进行点赞操作
8. **收藏/取消收藏**：对帖子进行收藏操作
9. **评论管理**：对帖子进行评论和回复
10. **标签关联**：为帖子关联多个标签，便于分类和搜索
11. **封面图片**：支持为帖子设置封面图片
12. **问答帖采纳回答**：问答帖支持采纳最佳回答的功能

### 2.4 特殊功能

#### 问答帖采纳机制
问答帖支持采纳最佳回答的功能，通过`accepted_answer_id`字段记录被采纳的回答ID，提升问答社区的互动体验。

#### 热度计算
帖子热度基于浏览量、点赞数、评论数、收藏数和发布时间计算，支持按热度排序，帮助用户发现优质内容。

#### 多维度排序
支持按最新、最热、评论数、点赞数、收藏数等多种方式对帖子进行排序展示。

## 3. 领域模型设计

### 3.1 核心概念

1. **PostEntity（帖子实体）**：代表一个具体的帖子，包含帖子的基本属性和业务逻辑
2. **PostAggregate（帖子聚合根）**：作为帖子的聚合根，维护帖子与其相关标签的一致性边界
3. **PostType（帖子类型）**：枚举类型，定义帖子的类型
4. **PostStatus（帖子状态）**：枚举类型，定义帖子的状态

### 3.2 领域服务

1. **PostService**：帖子核心业务服务，实现所有业务逻辑
2. **PostHotScoreDomainService**：帖子热度计算领域服务
3. **PostQueryDomainService**：帖子查询领域服务

## 4. 数据库设计

### 4.1 核心表结构

#### 帖子表（post）
存储帖子的核心信息，包括：
- 基本信息：标题、内容、封面图片等
- 关联信息：作者ID、分类ID等
- 统计信息：浏览数、点赞数、评论数、收藏数等
- 状态信息：帖子类型、状态、是否加精等
- 时间信息：创建时间、更新时间、发布时间等

#### 帖子与标签关联表（post_tag）
用于维护帖子与标签的多对多关系。

## 5. 技术实现特点

### 5.1 DDD分层架构
严格遵循DDD四层架构：
- 用户接口层：提供RESTful API接口
- 应用层：负责业务流程编排
- 领域层：实现核心业务逻辑
- 基础设施层：处理技术细节实现

### 5.2 事务管理
通过事务参与者模式实现复杂的业务事务管理，确保数据一致性。

### 5.3 异步处理
浏览量更新采用异步处理方式，避免阻塞主线程，通过定时任务批量更新数据库。

### 5.4 缓存优化
结合Redis缓存热门帖子数据，提升系统性能。

## 6. API接口

### 6.1 主要接口
- `POST /api/post/create`：创建帖子
- `POST /api/post/saveDraft`：保存草稿
- `POST /api/post/publish`：发布帖子
- `GET /api/post/{id}`：获取帖子详情
- `POST /api/post/page`：分页获取帖子列表
- `GET /api/post/search`：搜索帖子
- `POST /api/post/accept-answer`：采纳回答（仅限问答帖）

### 6.2 权限控制
- 只有帖子作者才能编辑、发布或删除自己的帖子
- 只有问答帖的提问者才能采纳回答

## 7. 扩展性设计

### 7.1 多类型支持
通过`type`字段区分不同类型的帖子，便于未来扩展新的帖子类型。

### 7.2 标签系统
帖子可以关联多个标签，便于内容分类和发现，支持基于标签的内容推荐。

### 7.3 统计分析
完整的数据统计机制，为后续的数据分析和推荐系统提供基础。